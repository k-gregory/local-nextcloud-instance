- name: Check if Nextcloud directory exists
  stat:
    path: "{{ nextcloud_www_dir }}"
  register: nextcloud_dir

- name: Ensure backup directory exists
  file:
    path: /var/backups/nextcloud
    state: directory
    mode: '0755'

- name: Backup current Nextcloud
  archive:
    path: "{{ nextcloud_www_dir }}"
    dest: /var/backups/nextcloud/nextcloud-{{ ansible_date_time.iso8601 }}.tar.gz
  when: nextcloud_dir.stat.exists